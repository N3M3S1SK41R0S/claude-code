{
  "name": "NEMESIS - Team Notifications Hub (FIXED)",
  "nodes": [
    {
      "parameters": {},
      "id": "post-webhook",
      "name": "Notification Request",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 400],
      "webhookId": "notifications"
    },
    {
      "parameters": {
        "rule": { "interval": [{ "field": "hours", "hoursInterval": 6 }] }
      },
      "id": "scheduled-check",
      "name": "Scheduled Check",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [250, 600]
    },
    {
      "parameters": {
        "functionCode": "// Team Notification Hub\n// FIXED: Renamed from 'Social Media' because:\n// - Twitter/X: API is $100+/month\n// - Instagram: No posting API for personal accounts\n// - Facebook: Requires app review\n// - LinkedIn: Very restrictive API\n//\n// This workflow posts to TEAM TOOLS that have free APIs:\n// - Discord (free)\n// - Slack (free tier)\n// - Notion (free)\n\nconst input = $input.first().json;\n\nconst notification = {\n  id: 'NOTIF-' + Date.now(),\n  created_at: new Date().toISOString(),\n  content: input.content || input.message || input.text,\n  type: input.type || 'announcement',\n  targets: input.targets || input.platforms || ['discord'],\n  priority: input.priority || 'normal',\n  media_url: input.media_url || input.image\n};\n\n// Templates by type\nconst templates = {\n  announcement: { emoji: 'ðŸ“¢', prefix: 'Announcement' },\n  alert: { emoji: 'ðŸš¨', prefix: 'Alert' },\n  update: { emoji: 'ðŸ”„', prefix: 'Update' },\n  success: { emoji: 'âœ…', prefix: 'Success' },\n  error: { emoji: 'âŒ', prefix: 'Error' },\n  info: { emoji: 'â„¹ï¸', prefix: 'Info' },\n  reminder: { emoji: 'â°', prefix: 'Reminder' }\n};\n\nconst template = templates[notification.type] || templates.info;\nnotification.formatted = `${template.emoji} **${template.prefix}**: ${notification.content}`;\n\n// Validate targets\nconst validTargets = ['discord', 'slack', 'notion'];\nnotification.targets = notification.targets.filter(t => validTargets.includes(t));\n\nif (notification.targets.length === 0) {\n  notification.targets = ['discord'];\n}\n\nreturn [{ json: notification }];"
      },
      "id": "prepare",
      "name": "Prepare Notification",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [500, 400]
    },
    {
      "parameters": {
        "conditions": {
          "string": [{ "value1": "={{ $json.targets.includes('discord') }}", "value2": "true" }]
        }
      },
      "id": "check-discord",
      "name": "Discord?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [750, 250]
    },
    {
      "parameters": {
        "conditions": {
          "string": [{ "value1": "={{ $json.targets.includes('slack') }}", "value2": "true" }]
        }
      },
      "id": "check-slack",
      "name": "Slack?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [750, 450]
    },
    {
      "parameters": {
        "conditions": {
          "string": [{ "value1": "={{ $json.targets.includes('notion') }}", "value2": "true" }]
        }
      },
      "id": "check-notion",
      "name": "Notion?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [750, 650]
    },
    {
      "parameters": {
        "url": "={{ $env.DISCORD_WEBHOOK_URL }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ content: $json.formatted, username: 'NEMESIS Bot', embeds: $json.media_url ? [{ image: { url: $json.media_url } }] : [] }) }}",
        "options": {}
      },
      "id": "post-discord",
      "name": "Post to Discord",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1000, 200]
    },
    {
      "parameters": {
        "url": "={{ $env.SLACK_WEBHOOK_URL }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ text: $json.formatted, attachments: $json.media_url ? [{ image_url: $json.media_url }] : [] }) }}",
        "options": {}
      },
      "id": "post-slack",
      "name": "Post to Slack",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1000, 400]
    },
    {
      "parameters": {
        "resource": "page",
        "operation": "create",
        "databaseId": "={{ $env.NOTION_NOTIFICATIONS_DB }}",
        "propertiesUi": {
          "propertyValues": [
            { "key": "Name", "title": "={{ $json.type + ' - ' + $json.id }}" },
            { "key": "Content", "richText": "={{ $json.content }}" },
            { "key": "Type", "select": "={{ $json.type }}" },
            { "key": "Date", "date": "={{ $json.created_at }}" }
          ]
        }
      },
      "id": "log-notion",
      "name": "Log to Notion",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2,
      "position": [1000, 600],
      "credentials": { "notionApi": { "id": "notion-cred", "name": "Notion API" } }
    },
    {
      "parameters": {
        "functionCode": "// Aggregate results\nconst notification = $('Prepare Notification').first().json;\n\nconst result = {\n  notification_id: notification.id,\n  timestamp: new Date().toISOString(),\n  content: notification.content,\n  type: notification.type,\n  posted_to: notification.targets,\n  success: true\n};\n\nreturn [{ json: result }];"
      },
      "id": "aggregate",
      "name": "Aggregate Results",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1250, 400]
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={{ JSON.stringify($json) }}"
      },
      "id": "respond",
      "name": "Return Result",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1500, 400]
    }
  ],
  "connections": {
    "Notification Request": {
      "main": [[{ "node": "Prepare Notification", "type": "main", "index": 0 }]]
    },
    "Scheduled Check": {
      "main": [[{ "node": "Prepare Notification", "type": "main", "index": 0 }]]
    },
    "Prepare Notification": {
      "main": [[
        { "node": "Discord?", "type": "main", "index": 0 },
        { "node": "Slack?", "type": "main", "index": 0 },
        { "node": "Notion?", "type": "main", "index": 0 }
      ]]
    },
    "Discord?": {
      "main": [
        [{ "node": "Post to Discord", "type": "main", "index": 0 }],
        [{ "node": "Aggregate Results", "type": "main", "index": 0 }]
      ]
    },
    "Slack?": {
      "main": [
        [{ "node": "Post to Slack", "type": "main", "index": 0 }],
        [{ "node": "Aggregate Results", "type": "main", "index": 0 }]
      ]
    },
    "Notion?": {
      "main": [
        [{ "node": "Log to Notion", "type": "main", "index": 0 }],
        [{ "node": "Aggregate Results", "type": "main", "index": 0 }]
      ]
    },
    "Post to Discord": {
      "main": [[{ "node": "Aggregate Results", "type": "main", "index": 0 }]]
    },
    "Post to Slack": {
      "main": [[{ "node": "Aggregate Results", "type": "main", "index": 0 }]]
    },
    "Log to Notion": {
      "main": [[{ "node": "Aggregate Results", "type": "main", "index": 0 }]]
    },
    "Aggregate Results": {
      "main": [[{ "node": "Return Result", "type": "main", "index": 0 }]]
    }
  },
  "settings": { "executionOrder": "v1" },
  "tags": ["nemesis", "notifications", "discord", "slack", "notion", "fixed"],
  "notes": "FIXED: Renamed from 'Social Media' to 'Team Notifications'. Posts to Discord, Slack, Notion (free APIs). Does NOT post to Twitter/Instagram/Facebook/LinkedIn (require paid APIs or business verification)."
}
