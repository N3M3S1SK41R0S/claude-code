{
  "name": "NEMESIS - AI Content Generation Pipeline",
  "nodes": [
    {
      "parameters": {},
      "id": "content-request",
      "name": "Content Request",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 400],
      "webhookId": "ai-content"
    },
    {
      "parameters": {
        "functionCode": "// Content Request Validator & Router\nconst request = $input.first().json;\n\nconst contentPlan = {\n  request_id: 'REQ-' + Date.now(),\n  created_at: new Date().toISOString(),\n  type: request.type || 'article',\n  topic: request.topic || request.prompt,\n  style: request.style || 'professional',\n  language: request.language || 'fr',\n  platforms: request.platforms || ['notion'],\n  generate: {\n    text: true,\n    image: request.include_image !== false,\n    video: request.include_video || false\n  },\n  settings: {\n    text_model: request.text_model || 'gemini-pro',\n    image_model: request.image_model || 'midjourney',\n    video_model: request.video_model || 'heygen',\n    max_tokens: request.max_tokens || 2048,\n    temperature: request.temperature || 0.7\n  }\n};\n\nreturn [{ json: contentPlan }];"
      },
      "id": "plan-content",
      "name": "Plan Content",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [500, 400]
    },
    {
      "parameters": {
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpQueryAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ contents: [{ parts: [{ text: 'Generate a ' + $json.type + ' about: ' + $json.topic + '. Style: ' + $json.style + '. Language: ' + $json.language + '. Make it engaging and informative.' }] }], generationConfig: { temperature: $json.settings.temperature, maxOutputTokens: $json.settings.max_tokens } }) }}",
        "options": {}
      },
      "id": "generate-text",
      "name": "Generate Text (Gemini)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [750, 300],
      "credentials": { "httpQueryAuth": { "id": "google-ai-cred", "name": "Google AI Key" } }
    },
    {
      "parameters": {
        "functionCode": "// Extract generated text\nconst response = $input.first().json;\nconst plan = $('Plan Content').first().json;\n\nlet generatedText = '';\nif (response.candidates && response.candidates[0]) {\n  generatedText = response.candidates[0].content.parts[0].text;\n}\n\n// Generate image prompt from content\nconst imagePrompt = `${plan.topic}, ${plan.style} style, professional, high quality, 8k`;\n\nreturn [{ \n  json: {\n    ...plan,\n    content: {\n      text: generatedText,\n      word_count: generatedText.split(/\\s+/).length\n    },\n    image_prompt: imagePrompt\n  }\n}];"
      },
      "id": "process-text",
      "name": "Process Text",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1000, 300]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            { "value1": "={{ $json.generate.image }}", "value2": true }
          ]
        }
      },
      "id": "check-image",
      "name": "Generate Image?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [1250, 300]
    },
    {
      "parameters": {
        "url": "https://api.goapi.ai/mj/v2/imagine",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "requestMethod": "POST",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ prompt: $json.image_prompt + ' --ar 16:9 --v 6 --q 2', process_mode: 'fast' }) }}",
        "options": {}
      },
      "id": "generate-image",
      "name": "Generate Image (Midjourney)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1500, 200],
      "credentials": { "httpHeaderAuth": { "id": "goapi-cred", "name": "GoAPI Key" } }
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            { "value1": "={{ $json.generate.video }}", "value2": true }
          ]
        }
      },
      "id": "check-video",
      "name": "Generate Video?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [1250, 500]
    },
    {
      "parameters": {
        "url": "https://api.heygen.com/v2/video/generate",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "requestMethod": "POST",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ video_inputs: [{ character: { type: 'avatar', avatar_id: 'Daisy-inskirt-20220818' }, voice: { type: 'text', input_text: $json.content.text.substring(0, 1000) } }], dimension: { width: 1920, height: 1080 } }) }}",
        "options": {}
      },
      "id": "generate-video",
      "name": "Generate Video (HeyGen)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1500, 500],
      "credentials": { "httpHeaderAuth": { "id": "heygen-cred", "name": "HeyGen API" } }
    },
    {
      "parameters": {
        "functionCode": "// Aggregate all generated content\nconst items = $input.all();\nconst plan = $('Plan Content').first().json;\nconst textResult = $('Process Text').first().json;\n\nconst finalContent = {\n  request_id: plan.request_id,\n  completed_at: new Date().toISOString(),\n  topic: plan.topic,\n  type: plan.type,\n  content: {\n    text: textResult.content.text,\n    word_count: textResult.content.word_count,\n    image_url: null,\n    video_url: null\n  },\n  status: 'completed'\n};\n\n// Check for image result\nfor (const item of items) {\n  if (item.json.task_id) {\n    finalContent.content.image_task_id = item.json.task_id;\n  }\n  if (item.json.data?.video_id) {\n    finalContent.content.video_id = item.json.data.video_id;\n  }\n}\n\nreturn [{ json: finalContent }];"
      },
      "id": "aggregate-content",
      "name": "Aggregate Content",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1750, 400]
    },
    {
      "parameters": {
        "resource": "page",
        "operation": "create",
        "databaseId": "={{ $env.NOTION_CONTENT_DB }}",
        "propertiesUi": {
          "propertyValues": [
            { "key": "Name", "title": "={{ $json.topic }}" },
            { "key": "Type", "select": "={{ $json.type }}" },
            { "key": "Status", "select": "Generated" },
            { "key": "Date", "date": "={{ $json.completed_at }}" }
          ]
        },
        "blockUi": {
          "blockValues": [
            {
              "type": "paragraph",
              "richText": [{ "textContent": "={{ $json.content.text }}" }]
            }
          ]
        }
      },
      "id": "save-to-notion",
      "name": "Save to Notion",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2,
      "position": [2000, 300],
      "credentials": { "notionApi": { "id": "notion-cred", "name": "Notion API" } }
    },
    {
      "parameters": {
        "url": "https://discord.com/api/v10/channels/{{ $env.DISCORD_CONTENT_CHANNEL }}/messages",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "discordBotApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ embeds: [{ title: 'üìù New Content Generated', description: $json.topic, color: 5814783, fields: [{ name: 'Type', value: $json.type, inline: true }, { name: 'Words', value: String($json.content.word_count), inline: true }, { name: 'Status', value: $json.status, inline: true }], footer: { text: $json.request_id }, timestamp: $json.completed_at }] }) }}",
        "options": {}
      },
      "id": "notify-discord",
      "name": "Notify Discord",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [2000, 500]
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={{ JSON.stringify({ success: true, request_id: $json.request_id, content: $json.content }) }}"
      },
      "id": "respond",
      "name": "Respond",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [2250, 400]
    }
  ],
  "connections": {
    "Content Request": {
      "main": [[{ "node": "Plan Content", "type": "main", "index": 0 }]]
    },
    "Plan Content": {
      "main": [[{ "node": "Generate Text (Gemini)", "type": "main", "index": 0 }]]
    },
    "Generate Text (Gemini)": {
      "main": [[{ "node": "Process Text", "type": "main", "index": 0 }]]
    },
    "Process Text": {
      "main": [[
        { "node": "Generate Image?", "type": "main", "index": 0 },
        { "node": "Generate Video?", "type": "main", "index": 0 }
      ]]
    },
    "Generate Image?": {
      "main": [
        [{ "node": "Generate Image (Midjourney)", "type": "main", "index": 0 }],
        [{ "node": "Aggregate Content", "type": "main", "index": 0 }]
      ]
    },
    "Generate Video?": {
      "main": [
        [{ "node": "Generate Video (HeyGen)", "type": "main", "index": 0 }],
        [{ "node": "Aggregate Content", "type": "main", "index": 0 }]
      ]
    },
    "Generate Image (Midjourney)": {
      "main": [[{ "node": "Aggregate Content", "type": "main", "index": 0 }]]
    },
    "Generate Video (HeyGen)": {
      "main": [[{ "node": "Aggregate Content", "type": "main", "index": 0 }]]
    },
    "Aggregate Content": {
      "main": [[
        { "node": "Save to Notion", "type": "main", "index": 0 },
        { "node": "Notify Discord", "type": "main", "index": 0 },
        { "node": "Respond", "type": "main", "index": 0 }
      ]]
    }
  },
  "settings": { "executionOrder": "v1" },
  "tags": ["nemesis", "ai", "content", "pipeline", "generation"]
}
