{
  "name": "NEMESIS - Multi-Provider Translation Service",
  "nodes": [
    {
      "parameters": {},
      "id": "translate-webhook",
      "name": "Translate Request",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 400],
      "webhookId": "translation"
    },
    {
      "parameters": {
        "url": "https://api-free.deepl.com/v2/translate",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            { "name": "text", "value": "={{ $json.text }}" },
            { "name": "target_lang", "value": "={{ $json.target || 'EN' }}" },
            { "name": "source_lang", "value": "={{ $json.source || '' }}" }
          ]
        },
        "options": {}
      },
      "id": "deepl-translate",
      "name": "DeepL Translate",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [500, 250],
      "credentials": { "httpHeaderAuth": { "id": "deepl-cred", "name": "DeepL API" } }
    },
    {
      "parameters": {
        "url": "https://translation.googleapis.com/language/translate/v2",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpQueryAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ q: $json.text, target: $json.target || 'en', source: $json.source, format: 'text' }) }}",
        "options": {}
      },
      "id": "google-translate",
      "name": "Google Translate",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [500, 450],
      "credentials": { "httpQueryAuth": { "id": "google-translate-cred", "name": "Google Translate Key" } }
    },
    {
      "parameters": {
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpQueryAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ contents: [{ parts: [{ text: 'Translate the following text to ' + ($json.target_language || 'English') + '. Only output the translation, nothing else:\\n\\n' + $json.text }] }] }) }}",
        "options": {}
      },
      "id": "ai-translate",
      "name": "AI Translate (Gemini)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [500, 650],
      "credentials": { "httpQueryAuth": { "id": "google-ai-cred", "name": "Google AI Key" } }
    },
    {
      "parameters": {
        "functionCode": "// Language detection\nconst text = $input.first().json.text || '';\n\nconst langPatterns = {\n  fr: /[àâäéèêëïîôùûüÿœæç]/i,\n  es: /[áéíóúüñ¿¡]/i,\n  de: /[äöüß]/i,\n  it: /[àèéìòù]/i,\n  pt: /[ãõáàâéêíóôú]/i,\n  ru: /[а-яА-Я]/,\n  zh: /[\\u4e00-\\u9fff]/,\n  ja: /[\\u3040-\\u309f\\u30a0-\\u30ff]/,\n  ko: /[\\uac00-\\ud7af]/,\n  ar: /[\\u0600-\\u06ff]/\n};\n\nlet detected = 'en';\nfor (const [lang, pattern] of Object.entries(langPatterns)) {\n  if (pattern.test(text)) {\n    detected = lang;\n    break;\n  }\n}\n\nreturn [{ json: { ...($input.first().json), detected_language: detected } }];"
      },
      "id": "detect-language",
      "name": "Detect Language",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [250, 600]
    },
    {
      "parameters": {
        "functionCode": "// Normalize translation response\nconst response = $input.first().json;\nconst request = $('Translate Request').first().json;\n\nconst result = {\n  request_id: 'TRANS-' + Date.now(),\n  timestamp: new Date().toISOString(),\n  source_text: request.text,\n  source_lang: request.source || 'auto',\n  target_lang: request.target || 'en',\n  success: true,\n  translation: ''\n};\n\n// DeepL response\nif (response.translations) {\n  result.translation = response.translations[0]?.text || '';\n  result.detected_lang = response.translations[0]?.detected_source_language;\n  result.provider = 'deepl';\n}\n// Google response\nelse if (response.data?.translations) {\n  result.translation = response.data.translations[0]?.translatedText || '';\n  result.detected_lang = response.data.translations[0]?.detectedSourceLanguage;\n  result.provider = 'google';\n}\n// Gemini response\nelse if (response.candidates) {\n  result.translation = response.candidates[0]?.content?.parts?.[0]?.text || '';\n  result.provider = 'gemini';\n}\n// Error\nelse if (response.error) {\n  result.success = false;\n  result.error = response.error.message || 'Translation failed';\n}\n\nresult.char_count = result.translation.length;\n\nreturn [{ json: result }];"
      },
      "id": "normalize-result",
      "name": "Normalize Result",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [750, 400]
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={{ JSON.stringify($json) }}"
      },
      "id": "respond",
      "name": "Return Translation",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1000, 400]
    }
  ],
  "connections": {
    "Translate Request": {
      "main": [[{ "node": "DeepL Translate", "type": "main", "index": 0 }]]
    },
    "DeepL Translate": {
      "main": [[{ "node": "Normalize Result", "type": "main", "index": 0 }]]
    },
    "Google Translate": {
      "main": [[{ "node": "Normalize Result", "type": "main", "index": 0 }]]
    },
    "AI Translate (Gemini)": {
      "main": [[{ "node": "Normalize Result", "type": "main", "index": 0 }]]
    },
    "Detect Language": {
      "main": [[{ "node": "DeepL Translate", "type": "main", "index": 0 }]]
    },
    "Normalize Result": {
      "main": [[{ "node": "Return Translation", "type": "main", "index": 0 }]]
    }
  },
  "settings": { "executionOrder": "v1" },
  "tags": ["nemesis", "translation", "deepl", "google", "multilingual"]
}
