{
  "name": "NEMESIS - Universal API Router (FIXED)",
  "nodes": [
    {
      "parameters": {},
      "id": "api-webhook",
      "name": "API Request",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 400],
      "webhookId": "api-router"
    },
    {
      "parameters": {
        "functionCode": "// Universal API Router\n// NOTE: This is NOT an MCP bridge (MCP uses stdio, not HTTP)\n// This is a webhook router that forwards requests to various services\n\nconst request = $input.first().json;\n\nconst parsed = {\n  request_id: 'API-' + Date.now(),\n  received_at: new Date().toISOString(),\n  target: request.target || request.service || 'unknown',\n  action: request.action || request.method || 'default',\n  params: request.params || request.data || request.input || {}\n};\n\n// Route mapping\nconst routes = {\n  'n8n': { base: 'http://localhost:5678/api/v1', auth: 'n8n' },\n  'notion': { base: 'https://api.notion.com/v1', auth: 'notion' },\n  'github': { base: 'https://api.github.com', auth: 'github' },\n  'openai': { base: 'https://api.openai.com/v1', auth: 'openai' },\n  'claude': { base: 'https://api.anthropic.com/v1', auth: 'anthropic' },\n  'gemini': { base: 'https://generativelanguage.googleapis.com/v1beta', auth: 'google' }\n};\n\nconst route = routes[parsed.target];\nif (route) {\n  parsed.base_url = route.base;\n  parsed.auth_type = route.auth;\n  parsed.valid = true;\n} else {\n  parsed.valid = false;\n  parsed.error = `Unknown target: ${parsed.target}. Valid: ${Object.keys(routes).join(', ')}`;\n}\n\nreturn [{ json: parsed }];"
      },
      "id": "parse-request",
      "name": "Parse Request",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [500, 400]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [{ "value1": "={{ $json.valid }}", "value2": true }]
        }
      },
      "id": "check-valid",
      "name": "Valid Request?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [750, 400]
    },
    {
      "parameters": {
        "functionCode": "// Build endpoint URL based on target and action\nconst req = $input.first().json;\n\nconst endpoints = {\n  'n8n': {\n    'list_workflows': { method: 'GET', path: '/workflows' },\n    'execute': { method: 'POST', path: `/workflows/${req.params.workflow_id}/execute` },\n    'get_executions': { method: 'GET', path: '/executions' }\n  },\n  'notion': {\n    'query_database': { method: 'POST', path: `/databases/${req.params.database_id}/query` },\n    'create_page': { method: 'POST', path: '/pages' },\n    'get_page': { method: 'GET', path: `/pages/${req.params.page_id}` }\n  },\n  'github': {\n    'list_repos': { method: 'GET', path: '/user/repos' },\n    'create_issue': { method: 'POST', path: `/repos/${req.params.owner}/${req.params.repo}/issues` },\n    'get_repo': { method: 'GET', path: `/repos/${req.params.owner}/${req.params.repo}` }\n  },\n  'openai': {\n    'chat': { method: 'POST', path: '/chat/completions' },\n    'embeddings': { method: 'POST', path: '/embeddings' },\n    'images': { method: 'POST', path: '/images/generations' }\n  },\n  'claude': {\n    'messages': { method: 'POST', path: '/messages' }\n  },\n  'gemini': {\n    'generate': { method: 'POST', path: '/models/gemini-pro:generateContent' }\n  }\n};\n\nconst targetEndpoints = endpoints[req.target] || {};\nconst endpoint = targetEndpoints[req.action] || { method: 'GET', path: '' };\n\nreq.url = req.base_url + endpoint.path;\nreq.method = endpoint.method;\nreq.body = req.params;\n\nreturn [{ json: req }];"
      },
      "id": "build-endpoint",
      "name": "Build Endpoint",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1000, 300]
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            { "name": "Content-Type", "value": "application/json" }
          ]
        },
        "requestMethod": "={{ $json.method }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify($json.body) }}",
        "options": { "timeout": 30000 }
      },
      "id": "call-api",
      "name": "Call External API",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1250, 300]
    },
    {
      "parameters": {
        "functionCode": "// Format successful response\nconst response = $input.first().json;\nconst request = $('Parse Request').first().json;\n\nconst result = {\n  request_id: request.request_id,\n  success: true,\n  target: request.target,\n  action: request.action,\n  timestamp: new Date().toISOString(),\n  data: response\n};\n\n// Handle error responses\nif (response.error) {\n  result.success = false;\n  result.error = response.error;\n}\n\nreturn [{ json: result }];"
      },
      "id": "format-success",
      "name": "Format Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1500, 300]
    },
    {
      "parameters": {
        "functionCode": "// Format error response\nconst request = $input.first().json;\n\nreturn [{ json: {\n  request_id: request.request_id,\n  success: false,\n  error: request.error || 'Invalid request',\n  valid_targets: ['n8n', 'notion', 'github', 'openai', 'claude', 'gemini'],\n  example: {\n    target: 'openai',\n    action: 'chat',\n    params: {\n      model: 'gpt-4',\n      messages: [{ role: 'user', content: 'Hello!' }]\n    }\n  }\n}}];"
      },
      "id": "format-error",
      "name": "Format Error",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1000, 500]
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={{ JSON.stringify($json) }}"
      },
      "id": "respond",
      "name": "Return Result",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1750, 400]
    }
  ],
  "connections": {
    "API Request": {
      "main": [[{ "node": "Parse Request", "type": "main", "index": 0 }]]
    },
    "Parse Request": {
      "main": [[{ "node": "Valid Request?", "type": "main", "index": 0 }]]
    },
    "Valid Request?": {
      "main": [
        [{ "node": "Build Endpoint", "type": "main", "index": 0 }],
        [{ "node": "Format Error", "type": "main", "index": 0 }]
      ]
    },
    "Build Endpoint": {
      "main": [[{ "node": "Call External API", "type": "main", "index": 0 }]]
    },
    "Call External API": {
      "main": [[{ "node": "Format Response", "type": "main", "index": 0 }]]
    },
    "Format Response": {
      "main": [[{ "node": "Return Result", "type": "main", "index": 0 }]]
    },
    "Format Error": {
      "main": [[{ "node": "Return Result", "type": "main", "index": 0 }]]
    }
  },
  "settings": { "executionOrder": "v1" },
  "tags": ["nemesis", "api", "router", "gateway", "fixed"],
  "notes": "Universal API Router - Routes requests to various services. NOT an MCP bridge (MCP uses stdio protocol, not HTTP). Configure API credentials in n8n credentials."
}
